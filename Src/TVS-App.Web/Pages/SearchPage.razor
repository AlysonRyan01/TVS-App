@page "/buscar-os"
@using Microsoft.AspNetCore.Authorization
@using TVS_App.Domain.Entities
@using TVS_App.Domain.Enums
@layout MainLayout
@attribute [Authorize] 

<div class="flex flex-col lg:flex-row justify-center">
    <div class="flex w-full lg:max-w-[50%] border border-cinza  rounded-lg shadow-lg p-3 mb-8">
        <div class="flex flex-col w-full p-5 items-start gap-3">
            <div class="flex flex-col w-full mb-12">
                <h1 class="font-sans mb-3 font-bold text-xl text-titlecolor">Filtrar pelo número da ordem</h1>
                <MudTextField
                    @bind-Value="_numberFilter"
                    Loading="@_isLoading"
                    ResetValueOnEmptyText="true"
                    AdornmentIcon="@Icons.Material.Filled.Person2"
                    IconSize="Size.Large"
                    AdornmentColor="Color.Primary"
                    Variant="Variant.Text"
                    Placeholder="Digite o número da ordem"
                    Class="max-w-[300px]"
                    />

                <MudButton OnClick="SearchByNumberAsync" Class="self-start mt-2" Variant="Variant.Text" Color="Color.Primary">Filtrar</MudButton>

            </div>
            <div class="flex flex-col w-full mb-12">
                <h1 class="font-sans mb-3 font-bold text-xl text-titlecolor">Filtrar pelo cliente</h1>
                <MudAutocomplete T="Customer"
                                 @bind-Value="_customerFilter"
                                 SearchFunc="SearchCustomers"
                                 ToStringFunc="@(c => c?.Name?.CustomerName ?? "")"
                                 MinCharacters="2"
                                 ResetValueOnEmptyText="true"
                                 Clearable="true"
                                 Loading="@_isLoading"
                                 Variant="Variant.Text"
                                 Class="max-w-[300px]"
                                 Placeholder="Digite o nome do cliente"/>

                <MudButton OnClick="SearchByCustomerNameAsync" Class="self-start mt-2" Variant="Variant.Text" Color="Color.Primary">Filtrar</MudButton>

            </div>
            <div class="flex flex-col w-full mb-12">
                <h1 class="font-sans mb-3 font-bold text-xl text-titlecolor">Filtrar pelo número de série</h1>
                <MudTextField
                    @bind-Value="_serialNumberFilter"
                    Loading="@_isLoading"
                    ResetValueOnEmptyText="true"
                    Variant="Variant.Text"
                    Placeholder="Digite o número de série do produto"
                    Class="max-w-[300px]"
                />

                <MudButton OnClick="SearchBySerialNumberAsync" Class="self-start mt-2" Variant="Variant.Text" Color="Color.Primary">Filtrar</MudButton>

            </div>
            <!-- Filtro por modelo -->
            <div class="flex flex-col w-full mb-12">
                <h1 class="font-sans mb-3 font-bold text-xl text-titlecolor">Filtrar pelo modelo do produto</h1>
                <MudTextField
                    @bind-Value="_modelFilter"
                    Loading="@_isLoading"
                    ResetValueOnEmptyText="true"
                    Variant="Variant.Text"
                    Placeholder="Digite o modelo do produto"
                    Class="max-w-[300px]" />
                <MudButton OnClick="SearchByModelAsync" Class="self-start mt-2" Variant="Variant.Text" Color="Color.Primary">Filtrar</MudButton>
            </div>

            <!-- Filtro por empresa -->
            <div class="flex flex-col w-full mb-12">
                <h1 class="font-sans mb-3 font-bold text-xl text-titlecolor">Filtrar pela empresa</h1>
                <MudSelect T="EEnterprise"
                           @bind-Value="_enterpriseFilter"
                           Variant="Variant.Text"
                           Class="max-w-[300px]"
                           Placeholder="Selecione a empresa">
                    @foreach (var enterprise in Enum.GetValues<EEnterprise>())
                    {
                        <MudSelectItem Value="@(enterprise)">@enterprise.ToString()</MudSelectItem>
                    }
                </MudSelect>
                <MudButton OnClick="SearchByEnterpriseAsync" Class="self-start mt-2" Variant="Variant.Text" Color="Color.Primary">Filtrar</MudButton>
            </div>

            <!-- Filtro por data -->
            <div class="flex flex-col w-full mb-12">
                <h1 class="font-sans mb-3 font-bold text-xl text-titlecolor">Filtrar por data</h1>
                <MudDatePicker Label="Data inicial"
                               @bind-Date="_startDateFilter"
                               Class="max-w-[300px]"
                               Variant="Variant.Text" />
                <MudDatePicker Label="Data final"
                               @bind-Date="_endDateFilter"
                               Class="max-w-[300px] mt-2"
                               Variant="Variant.Text" />
                <MudButton OnClick="SearchByDateAsync" Class="self-start mt-2" Variant="Variant.Text" Color="Color.Primary">Filtrar</MudButton>
            </div>
        </div>
    </div>
    <div class="flex w-full lg:max-w-[50%] border border-cinza rounded-lg shadow-lg p-3 sticky top-0 h-[80vh]">
        <div class="flex flex-col w-full p-5 items-center">
            <div class="flex flex-col w-full mb-10">
                <h1 class="font-playpen underline mb-3 font-extrabold text-2xl text-titlecolor">
                    Ordens de serviço filtradas: @_filteredServiceOrderCount
                </h1>
            </div>
        </div>
    </div>
</div>